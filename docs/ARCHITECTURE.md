# Архитектура бота ОбучAI

## Общая схема

```
┌─────────────────────────────────────────────────────────────┐
│                    Telegram Bot (bot.py)                     │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
        ┌───────────────────────────────┐
        │  Блок 1: Нормализация        │
        └───────────┬───────────────────┘
                    │
        ┌───────────┴───────────┐
        │                     │
    question          abuse/off_topic/cheat
        │                     │
        ▼                     ▼
┌───────────────┐    ┌──────────────────┐
│ Блок 2: RAG  │    │ Шаблонный ответ  │
└───────┬───────┘    └────────┬─────────┘
        │                     │
        ▼                     │
┌───────────────┐             │
│ Блок 3:       │             │
│ Генерация     │             │
└───────┬───────┘             │
        │                     │
        ▼                     │
┌───────────────┐             │
│ Блок 4: Judge │ (скрыто)    │
└───────┬───────┘             │
        │                     │
        ▼                     │
┌───────────────┐             │
│ Блок 5:       │             │
│ Обратная связь│             │
└───────────────┘             │
```

## Модули (корень проекта)

| Файл | Назначение |
|------|------------|
| `bot.py` | Точка входа, Telegram, связка блоков 1–5 |
| `config.py` | Конфигурация (пути, ключи, параметры RAG/LLM) |
| `gigachat_client.py` | Клиент GigaChat API |
| `block1_normalization.py` | Классификация и нормализация запроса |
| `block2_rag.py` | Загрузка документов, чанки, ChromaDB, поиск |
| `block3_generation.py` | Генерация ответа по контексту |
| `block4_judge.py` | LLM-Judge (оценка качества, скрыто) |
| `block5_feedback.py` | Логи обратной связи, эскалация куратору |

## Данные

- **knowledge_base/** — материалы курса (PDF, TXT, MD, DOCX)
- **vector_db/** — векторная БД ChromaDB (создаётся при запуске)
- **logs/** — feedback_log.json, judge_log.json, escalation_log.json

## Конфигурация

Переменные окружения (`.env`): `TELEGRAM_BOT_TOKEN`, `GIGACHAT_AUTH_KEY`, `CURATOR_CHAT_ID`. Остальное в `config.py`.
